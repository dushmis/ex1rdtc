
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<link href='http://fonts.googleapis.com/css?family=Merriweather:400,300italic' rel='stylesheet' type='text/css'>
<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.0.4/css/bootstrap-combined.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.16/angular.min.js"></script>
<style>
  .tab-content{
    color: #222;
    font: 400 14px/18px "Merriweather";
    text-indent: 14px;
  }
  .midnews{
    padding-top: 10px;
  }
  span.midnews-date{
    color:gray;
  }
</style>
  


<script type='text/javascript'>//<![CDATA[ 

angular.module('components', [])

  .directive('tabs', function() {
    return {
      restrict: 'E',
      transclude: true,
      scope: {},
      controller: function($scope, $element) {
        var panes = $scope.panes = [];

        $scope.select = function(pane) {
          angular.forEach(panes, function(pane) {
            pane.selected = false;
          });
          pane.selected = true;
        }

        this.addPane = function(pane) {
          if (panes.length == 0) $scope.select(pane);
          panes.push(pane);
        }
      },
      template:
        '<div class="tabbable">' +
          '<ul class="nav nav-tabs">' +
            '<li ng-repeat="pane in panes" ng-class="{active:pane.selected}">'+
              '<a href="" ng-click="select(pane)">{{pane.title}}</a>' +
            '</li>' +
          '</ul>' +
          '<div class="tab-content" ng-transclude></div>' +
        '</div>',
      replace: true
    };
  })

  .directive('pane', function() {
    return {
      require: '^tabs',
      restrict: 'E',
      transclude: true,
      scope: { title: '@' },
      link: function(scope, element, attrs, tabsCtrl) {
        tabsCtrl.addPane(scope);
      },
      template:
        '<div class="tab-pane" ng-class="{active: selected}" ng-transclude>' +
        '</div>',
      replace: true
    };
  })

angular.module("app", ["components"]).controller("NewsController", function($scope, $http, $templateCache, $interval, $timeout) {
  $scope.method = "GET";
  $scope.source = "worldnews+breakingnews+news";
  $scope.predicate = "ups";
  $scope.predicate_ = "created";
  $scope.ascorder = true;
  $scope.fetch = function() {
    var rows_news = [];
    var rows_breakingnews = [];
    $scope.url = "http://www.reddit.com/r/" + $scope.source + "/.json?limit=50";
    $scope.code = null;
    $scope.response = null;
    $http({method:$scope.method, url:$scope.url, cache:$templateCache}).success(function(data, status) {
      $scope.status = status;
      data.data.children.forEach(function(a, b) {
        if (a.data.subreddit == "worldnews" || a.data.subreddit == "news") {
          if (b <= 20) {
            rows_news.push(a.data);
          }
        }
        if (a.data.subreddit == "breakingnews") {
          if (b <= 20) {
            rows_breakingnews.push(a.data);
          }
        }
        console.log(a.data.subreddit);
      });
      $scope.allnews = rows_news;
      $scope.allbreakingnews = rows_breakingnews;
      console.log(data.data.children);
    }).error(function(data, status) {
      $scope.allnews = data || "Request failed";
      $scope.allbreakingnews = data || "Request failed";
      $scope.status = status;
    });
  };
  stop = $interval(function() {
    $scope.fetch();
  }, 3E4);
  console.log(stop);
  stop_timeout = $timeout(function() {
    $scope.fetch();
    console.log("timeout executed");
  }, 100);
});


//]]>  

</script>


</head>
<body>
  <div ng-app="app">
  <tabs>
    <pane title="Worldnews">
      <div ng-controller="NewsController">
        <div data-read={{newstory}} ng-repeat="newstory in allnews | orderBy:predicate_:ascorder" class="midnews">
          &dash; <a class="midnews-text" href={{newstory.url}} target="_blank" >{{newstory.title}}</a> &mdash; <span class="midnews-date">{{newstory.created*1000 | date:'fullDate'}}</span>
        </div>
      </div>
    </pane>
    <pane title="Breakingnews">
      <div ng-controller="NewsController">
        <div data-read={{newstory}} ng-repeat="newstory in allbreakingnews | orderBy:predicate:ascorder" class="midnews">
          &dash; <a class="midnews-text" href={{newstory.url}} target="_blank" >{{newstory.title}}</a> &mdash; <span class="midnews-date">{{newstory.created*1000 | date:'fullDate'}}</span>
        </div>
      </div>
    </pane>
  </tabs>
</div>

  
</body>


</html>

